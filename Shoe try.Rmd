---
title: "Shoe try"
author: "Blake Lin"
date: "4/21/2022"
output: html_document
---

## Discussion Note
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(zoo)

monthly_retail_df <- read_csv("data/monthly_retail.csv")
monthly_retail_df1 <- read_csv("data/monthly_retail.csv")
sp_index_df <- read_csv("data/sp_index_df.csv")
shoe_data <- read_csv("data/shoe_data.csv")

#Demographic
  # state population
  # state income

#Market Trend
  # ETF price - consumer good/ S&P 500
  # retail sales trend - US Census Bureau

#Popularity
  #Team performance
  #google search trend
  #social media
  #Kayne's song on chart 

#Product
  # Shoe dimension
  # material


# Branden: data analysis: https://thehustle.co/shark-tank-data-analysis-10-seasons/
# Blake: random forest, linear (lasso) on premium
# Jayme: variable, introduction
```




### Data Cleaning 
```{r data cleaning, echo=FALSE}

# put on time stamp for every data sets
shoe_data = shoe_data %>% 
  mutate(time_stamp=mdy(shoe_data$order_date), .before=order_date)

#sporting good index
monthly_retail_df=monthly_retail_df %>% 
  mutate(time_stamp=mdy(Period), .before = Period)
monthly_retail_df = monthly_retail_df[ ,-(2)]

monthly_retail_df = monthly_retail_df%>%
group_by(time_stamp) %>%
expand(time_stamp = seq(floor_date(time_stamp, unit = "month"),
       ceiling_date(time_stamp, unit="month")-days(1), by="day"), sporting_goods) %>% as.data.frame()

# retail monthly index
monthly_retail_df1=monthly_retail_df1 %>% 
  mutate(time_stamp=mdy(Period), .before = Period)
monthly_retail_df1 = monthly_retail_df1[ ,-(2)]

monthly_retail_df1 = monthly_retail_df1%>%
group_by(time_stamp) %>%
expand(time_stamp = seq(floor_date(time_stamp, unit = "month"),
       ceiling_date(time_stamp, unit="month")-days(1), by="day"), monthly_retail) %>% as.data.frame()


#sp index
sp_index_df = sp_index_df[ ,-(3:10)]

sp_index_df = sp_index_df%>% 
  mutate(time_stamp=mdy(date), .before= date)

sp_index_df = sp_index_df[ ,-(2)]

# merge 
shoe_data = shoe_data %>%
    left_join(monthly_retail_df, by='time_stamp') %>%
    left_join(monthly_retail_df1, by='time_stamp')%>%
    left_join(sp_index_df, by='time_stamp')

shoe_data = na.locf(shoe_data)




#team performance stuff
ncaa_teams = read.csv("data/ncaa.csv")
ncaa_teams = ncaa_teams %>%
  filter(To >= 2019 & From <= 2019) 

# aggregate teams by state
agg_ncaa = data.frame(
ncaa_teams %>%
  group_by(State) %>%
  summarise(across(c("Overall_Win_Loss_Percentage", "Win_Percentage_2019","Win_Percentage_2018", "Yrs", "AP_Rank_2019", "AP_Ranked_2018"), ~ mean(.x, na.rm = TRUE)))
,
  ncaa_teams %>%
  group_by(State) %>%
  summarise(across(c("NCAA_Tournament_Appearances", "Final_Four_Appearances","NCAA_Championships", "AP_Final_Poll_Appearances"), ~ sum(.x, na.rm = TRUE)))
)

shoe_data = merge(shoe_data, df, by.x = "buyer_region", by.y="State", all.x = TRUE)

#shoe characteristics
shoe_characteristics = read.csv("data/shoe_characteristics.csv")

shoe_data = merge(shoe_data, shoe_characteristics, by.x = "sneaker_name", by.y="Shoe", all.x = TRUE)



```


### Explain Variables
`sporting_goods`: Monthly Seasonally Adjusted Sales (in Millions of Dollars) in Advance Monthly Sales for Retail and Food Services: U.S. Total

`monthly_retail`: Monthly Seasonally Adjusted Sales (in Millions of Dollars) in Sporting Goods, Hobby, Musical Instrument, and Book Stores: U.S. Total

`sp_index`: the index comprises stocks in the S&P toal market index that are classified as in the GICS retail sub-indsutry





### Reference 
##### S&P Retail Select Industry Index
https://www.spglobal.com/spdji/en/indices/equity/sp-retail-select-industry-index/#overview

##### US Census Bureau
https://www.census.gov/retail/marts/historic_releases.html

